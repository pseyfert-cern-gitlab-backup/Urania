#define MVAntuple_cxx
#include "MVAntuple.h"
#include <TH2.h>
#include <TStyle.h>
#include <TCanvas.h>
#include "Rich1DTabFunc.h"

void MVAntuple::Loop()
{
  //   In a ROOT session, you can do:
  //      Root > .L MVAntuple.C
  //      Root > MVAntuple t
  //      Root > t.GetEntry(12); // Fill t data members with entry number 12
  //      Root > t.Show();       // Show values of entry 12
  //      Root > t.Show(16);     // Read and show values of entry 16
  //      Root > t.Loop();       // Loop on all entries
  //

  //     This is the loop skeleton where:
  //    jentry is the global entry number in the chain
  //    ientry is the entry number in the current Tree
  //  Note that the argument to GetEntry must be:
  //    jentry for TChain::GetEntry
  //    ientry for TTree::GetEntry and TBranch::GetEntry
  //
  //       To read only selected branches, Insert statements like:
  // METHOD1:
  //    fChain->SetBranchStatus("*",0);  // disable all branches
  //    fChain->SetBranchStatus("branchname",1);  // activate branchname
  // METHOD2: replace line
  //    fChain->GetEntry(jentry);       //read all branches
  //by  b_branchname->GetEntry(ientry); //read only this branch
  if (fChain == 0) return;


// Initialisation (should do this just once, slow)
double inputMIX[300] = {-0.01, -0.0066, -0.0032, 0.0002, 0.0036, 0.007, 0.0104, 0.0138, 0.0172, 0.0206, 0.024, 0.0274, 0.0308, 0.0342, 0.0376, 0.041, 0.0444, 0.0478, 0.0512, 0.0546, 0.058, 0.0614, 0.0648, 0.0682, 0.0716, 0.075, 0.0784, 0.0818, 0.0852, 0.0886, 0.092, 0.0954, 0.0988, 0.1022, 0.1056, 0.109, 0.1124, 0.1158, 0.1192, 0.1226, 0.126, 0.1294, 0.1328, 0.1362, 0.1396, 0.143, 0.1464, 0.1498, 0.1532, 0.1566, 0.16, 0.1634, 0.1668, 0.1702, 0.1736, 0.177, 0.1804, 0.1838, 0.1872, 0.1906, 0.194, 0.1974, 0.2008, 0.2042, 0.2076, 0.211, 0.2144, 0.2178, 0.2212, 0.2246, 0.228, 0.2314, 0.2348, 0.2382, 0.2416, 0.245, 0.2484, 0.2518, 0.2552, 0.2586, 0.262, 0.2654, 0.2688, 0.2722, 0.2756, 0.279, 0.2824, 0.2858, 0.2892, 0.2926, 0.296, 0.2994, 0.3028, 0.3062, 0.3096, 0.313, 0.3164, 0.3198, 0.3232, 0.3266, 0.33, 0.3334, 0.3368, 0.3402, 0.3436, 0.347, 0.3504, 0.3538, 0.3572, 0.3606, 0.364, 0.3674, 0.3708, 0.3742, 0.3776, 0.381, 0.3844, 0.3878, 0.3912, 0.3946, 0.398, 0.4014, 0.4048, 0.4082, 0.4116, 0.415, 0.4184, 0.4218, 0.4252, 0.4286, 0.432, 0.4354, 0.4388, 0.4422, 0.4456, 0.449, 0.4524, 0.4558, 0.4592, 0.4626, 0.466, 0.4694, 0.4728, 0.4762, 0.4796, 0.483, 0.4864, 0.4898, 0.4932, 0.4966, 0.5, 0.5034, 0.5068, 0.5102, 0.5136, 0.517, 0.5204, 0.5238, 0.5272, 0.5306, 0.534, 0.5374, 0.5408, 0.5442, 0.5476, 0.551, 0.5544, 0.5578, 0.5612, 0.5646, 0.568, 0.5714, 0.5748, 0.5782, 0.5816, 0.585, 0.5884, 0.5918, 0.5952, 0.5986, 0.602, 0.6054, 0.6088, 0.6122, 0.6156, 0.619, 0.6224, 0.6258, 0.6292, 0.6326, 0.636, 0.6394, 0.6428, 0.6462, 0.6496, 0.653, 0.6564, 0.6598, 0.6632, 0.6666, 0.67, 0.6734, 0.6768, 0.6802, 0.6836, 0.687, 0.6904, 0.6938, 0.6972, 0.7006, 0.704, 0.7074, 0.7108, 0.7142, 0.7176, 0.721, 0.7244, 0.7278, 0.7312, 0.7346, 0.738, 0.7414, 0.7448, 0.7482, 0.7516, 0.755, 0.7584, 0.7618, 0.7652, 0.7686, 0.772, 0.7754, 0.7788, 0.7822, 0.7856, 0.789, 0.7924, 0.7958, 0.7992, 0.8026, 0.806, 0.8094, 0.8128, 0.8162, 0.8196, 0.823, 0.8264, 0.8298, 0.8332, 0.8366, 0.84, 0.8434, 0.8468, 0.8502, 0.8536, 0.857, 0.8604, 0.8638, 0.8672, 0.8706, 0.874, 0.8774, 0.8808, 0.8842, 0.8876, 0.891, 0.8944, 0.8978, 0.9012, 0.9046, 0.908, 0.9114, 0.9148, 0.9182, 0.9216, 0.925, 0.9284, 0.9318, 0.9352, 0.9386, 0.942, 0.9454, 0.9488, 0.9522, 0.9556, 0.959, 0.9624, 0.9658, 0.9692, 0.9726, 0.976, 0.9794, 0.9828, 0.9862, 0.9896, 0.993, 0.9964, 0.9998, 1.0032, 1.0066};
double outputMIX[300] = {0, 0, 0, 0.000296696, 0.00725556, 0.0141065, 0.0209036, 0.0277546, 0.0347404, 0.0417532, 0.0488469, 0.0541875, 0.0612812, 0.0671881, 0.0732569, 0.0802428, 0.0880108, 0.0935671, 0.09853, 0.10619, 0.112717, 0.11849, 0.125556, 0.131679, 0.13764, 0.144221, 0.150479, 0.155738, 0.161726, 0.168658, 0.175671, 0.181416, 0.187323, 0.192879, 0.199083, 0.204477, 0.211086, 0.217154, 0.222468, 0.229346, 0.235873, 0.240674, 0.246473, 0.252165, 0.258018, 0.264895, 0.26967, 0.27528, 0.280836, 0.286878, 0.292353, 0.297721, 0.303601, 0.309049, 0.314606, 0.318975, 0.324585, 0.330411, 0.335428, 0.340904, 0.346082, 0.351126, 0.35679, 0.361942, 0.366986, 0.372299, 0.377208, 0.382171, 0.387323, 0.392286, 0.398085, 0.405152, 0.410169, 0.413082, 0.418449, 0.423358, 0.428564, 0.432798, 0.43849, 0.444154, 0.450115, 0.453783, 0.458638, 0.463601, 0.468591, 0.472987, 0.478166, 0.483156, 0.488146, 0.493324, 0.497829, 0.5029, 0.507943, 0.51234, 0.51706, 0.521322, 0.526177, 0.530546, 0.535266, 0.53915, 0.543682, 0.547862, 0.552771, 0.557357, 0.561942, 0.565664, 0.569845, 0.574457, 0.578638, 0.582522, 0.586837, 0.591126, 0.595334, 0.599461, 0.603695, 0.608173, 0.61238, 0.615482, 0.619906, 0.623871, 0.628294, 0.63234, 0.636898, 0.640216, 0.644316, 0.648254, 0.652057, 0.655455, 0.660175, 0.664005, 0.667943, 0.671423, 0.67555, 0.679326, 0.683048, 0.686851, 0.690223, 0.694107, 0.698018, 0.701551, 0.705003, 0.708375, 0.711639, 0.715604, 0.718732, 0.722428, 0.726015, 0.729252, 0.733082, 0.736912, 0.740526, 0.744086, 0.747404, 0.750829, 0.754444, 0.757572, 0.760674, 0.763668, 0.766689, 0.769845, 0.772003, 0.775509, 0.778368, 0.782657, 0.785759, 0.789076, 0.792825, 0.795064, 0.797195, 0.800351, 0.802994, 0.805988, 0.808685, 0.811679, 0.814376, 0.817289, 0.819231, 0.822225, 0.825327, 0.827862, 0.830236, 0.833176, 0.83563, 0.838085, 0.840162, 0.84232, 0.844316, 0.846069, 0.85033, 0.853432, 0.856885, 0.859879, 0.863601, 0.866433, 0.867943, 0.869724, 0.871396, 0.873257, 0.875442, 0.877761, 0.880135, 0.882266, 0.884477, 0.886635, 0.888334, 0.890384, 0.892677, 0.895455, 0.897397, 0.899906, 0.902657, 0.90414, 0.905947, 0.907647, 0.909373, 0.911477, 0.913284, 0.915361, 0.917384, 0.919083, 0.921376, 0.923399, 0.925502, 0.927256, 0.929521, 0.931301, 0.93292, 0.934268, 0.935617, 0.937073, 0.938557, 0.940229, 0.941362, 0.942441, 0.944599, 0.946352, 0.947323, 0.949157, 0.950856, 0.952421, 0.953635, 0.955145, 0.956628, 0.957519, 0.958948, 0.960459, 0.961996, 0.963399, 0.964558, 0.965341, 0.966365, 0.966905, 0.96793, 0.969575, 0.971086, 0.972515, 0.973297, 0.974268, 0.975185, 0.976318, 0.977478, 0.978395, 0.979285, 0.980688, 0.981443, 0.982495, 0.983385, 0.984032, 0.984626, 0.98557, 0.986163, 0.986891, 0.987916, 0.988537, 0.989346, 0.990236, 0.991072, 0.99207, 0.992744, 0.993446, 0.993877, 0.994471, 0.994848, 0.995415, 0.996359, 0.997033, 0.997734, 0.99822, 0.998678, 0.999083, 0.999461, 0.999595, 0.999865, 0.999973, 0.999973, 1, 1, 1, 1, 1};
TabulatedFunction1D* FlattenMIX = new TabulatedFunction1D(inputMIX, outputMIX, 300, gsl_interp_linear);


// Initialisation (should do this just once, slow)
double inputNB[300] = {-1.2, -1.192, -1.184, -1.176, -1.168, -1.16, -1.152, -1.144, -1.136, -1.128, -1.12, -1.112, -1.104, -1.096, -1.088, -1.08, -1.072, -1.064, -1.056, -1.048, -1.04, -1.032, -1.024, -1.016, -1.008, -1, -0.992, -0.984, -0.976, -0.968, -0.96, -0.952, -0.944, -0.936, -0.928, -0.92, -0.912, -0.904, -0.896, -0.888, -0.88, -0.872, -0.864, -0.856, -0.848, -0.84, -0.832, -0.824, -0.816, -0.808, -0.8, -0.792, -0.784, -0.776, -0.768, -0.76, -0.752, -0.744, -0.736, -0.728, -0.72, -0.712, -0.704, -0.696, -0.688, -0.68, -0.672, -0.664, -0.656, -0.648, -0.64, -0.632, -0.624, -0.616, -0.608, -0.6, -0.592, -0.584, -0.576, -0.568, -0.56, -0.552, -0.544, -0.536, -0.528, -0.52, -0.512, -0.504, -0.496, -0.488, -0.48, -0.472, -0.464, -0.456, -0.448, -0.44, -0.432, -0.424, -0.416, -0.408, -0.4, -0.392, -0.384, -0.376, -0.368, -0.36, -0.352, -0.344, -0.336, -0.328, -0.32, -0.312, -0.304, -0.296, -0.288, -0.28, -0.272, -0.264, -0.256, -0.248, -0.24, -0.232, -0.224, -0.216, -0.208, -0.2, -0.192, -0.184, -0.176, -0.168, -0.16, -0.152, -0.144, -0.136, -0.128, -0.12, -0.112, -0.104, -0.096, -0.088, -0.08, -0.072, -0.064, -0.056, -0.048, -0.04, -0.032, -0.024, -0.016, -0.008, 0, 0.008, 0.016, 0.024, 0.032, 0.04, 0.048, 0.056, 0.064, 0.072, 0.08, 0.088, 0.096, 0.104, 0.112, 0.12, 0.128, 0.136, 0.144, 0.152, 0.16, 0.168, 0.176, 0.184, 0.192, 0.2, 0.208, 0.216, 0.224, 0.232, 0.24, 0.248, 0.256, 0.264, 0.272, 0.28, 0.288, 0.296, 0.304, 0.312, 0.32, 0.328, 0.336, 0.344, 0.352, 0.36, 0.368, 0.376, 0.384, 0.392, 0.4, 0.408, 0.416, 0.424, 0.432, 0.44, 0.448, 0.456, 0.464, 0.472, 0.48, 0.488, 0.496, 0.504, 0.512, 0.52, 0.528, 0.536, 0.544, 0.552, 0.56, 0.568, 0.576, 0.584, 0.592, 0.6, 0.608, 0.616, 0.624, 0.632, 0.64, 0.648, 0.656, 0.664, 0.672, 0.68, 0.688, 0.696, 0.704, 0.712, 0.72, 0.728, 0.736, 0.744, 0.752, 0.76, 0.768, 0.776, 0.784, 0.792, 0.8, 0.808, 0.816, 0.824, 0.832, 0.84, 0.848, 0.856, 0.864, 0.872, 0.88, 0.888, 0.896, 0.904, 0.912, 0.92, 0.928, 0.936, 0.944, 0.952, 0.96, 0.968, 0.976, 0.984, 0.992, 1, 1.008, 1.016, 1.024, 1.032, 1.04, 1.048, 1.056, 1.064, 1.072, 1.08, 1.088, 1.096, 1.104, 1.112, 1.12, 1.128, 1.136, 1.144, 1.152, 1.16, 1.168, 1.176, 1.184, 1.192};
double outputNB[300] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000997331, 0.00504057, 0.011348, 0.0188954, 0.0262541, 0.0308634, 0.0344214, 0.0416992, 0.0477371, 0.0492466, 0.0527777, 0.0570096, 0.0601094, 0.0641257, 0.067549, 0.070514, 0.0724009, 0.0745034, 0.0761207, 0.0778188, 0.0809725, 0.088466, 0.0991132, 0.102752, 0.104962, 0.10658, 0.108305, 0.111, 0.114639, 0.121054, 0.127497, 0.12995, 0.132564, 0.135987, 0.13933, 0.145907, 0.146716, 0.147659, 0.14898, 0.150139, 0.151271, 0.152538, 0.153993, 0.15553, 0.157066, 0.158225, 0.159169, 0.16084, 0.162107, 0.163994, 0.165287, 0.166797, 0.168091, 0.169465, 0.170786, 0.172269, 0.173455, 0.174964, 0.180733, 0.184506, 0.185908, 0.187148, 0.188523, 0.190113, 0.191569, 0.194264, 0.197499, 0.200571, 0.203105, 0.204156, 0.205423, 0.206367, 0.207095, 0.207634, 0.208577, 0.20979, 0.210787, 0.211758, 0.212486, 0.213564, 0.214938, 0.216124, 0.217445, 0.218443, 0.219494, 0.220545, 0.221785, 0.222944, 0.223941, 0.227553, 0.237931, 0.240411, 0.242432, 0.245047, 0.247904, 0.250249, 0.257797, 0.264886, 0.267824, 0.270978, 0.274266, 0.277285, 0.278875, 0.280035, 0.281059, 0.282353, 0.283188, 0.283916, 0.285075, 0.285776, 0.286719, 0.287501, 0.288471, 0.289442, 0.290358, 0.291248, 0.29211, 0.292973, 0.294024, 0.295075, 0.295884, 0.297016, 0.298013, 0.299253, 0.300062, 0.301086, 0.302299, 0.303431, 0.30451, 0.305642, 0.306666, 0.308175, 0.309604, 0.311356, 0.313108, 0.315588, 0.317906, 0.320629, 0.323243, 0.325588, 0.329389, 0.337718, 0.346694, 0.355131, 0.364188, 0.366155, 0.366937, 0.3678, 0.368447, 0.369282, 0.369875, 0.370711, 0.371627, 0.372193, 0.37284, 0.373703, 0.374565, 0.37559, 0.376237, 0.37718, 0.377746, 0.378609, 0.379768, 0.380765, 0.381951, 0.382814, 0.383973, 0.391197, 0.401547, 0.409984, 0.415699, 0.421143, 0.428179, 0.429392, 0.430389, 0.431252, 0.432303, 0.433111, 0.434324, 0.435403, 0.436184, 0.437236, 0.438368, 0.439473, 0.44074, 0.441953, 0.443058, 0.444729, 0.44605, 0.44702, 0.448476, 0.44977, 0.450983, 0.453678, 0.461576, 0.469743, 0.479582, 0.482924, 0.486482, 0.490094, 0.494461, 0.497695, 0.50066, 0.503437, 0.508747, 0.514327, 0.519637, 0.524839, 0.531066, 0.559584, 0.561147, 0.562953, 0.564624, 0.566592, 0.568479, 0.5698, 0.572145, 0.574247, 0.576296, 0.578129, 0.58104, 0.583924, 0.586593, 0.595218, 0.607644, 0.632659, 0.660422, 0.670935, 0.681959, 0.695248, 0.71541, 0.741287, 0.76498, 0.779185, 0.796868, 0.802501, 0.808701, 0.813903, 0.820912, 0.828243, 0.836815, 0.857759, 0.894633, 0.932586, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1};

  // Create object
  TabulatedFunction1D* FlattenNB;

  FlattenNB = new TabulatedFunction1D(inputNB, outputNB, 300, gsl_interp_linear);

  // Create object
  TabulatedFunction1D* FlattenTMVA;

  // Initialisation (should do this just once, slow)
  double inputTMVA[300] = {-1, -0.993333, -0.986667, -0.98, -0.973333, -0.966667, -0.96, -0.953333, -0.946667, -0.94, -0.933333, -0.926667, -0.92, -0.913333, -0.906667, -0.9, -0.893333, -0.886667, -0.88, -0.873333, -0.866667, -0.86, -0.853333, -0.846667, -0.84, -0.833333, -0.826667, -0.82, -0.813333, -0.806667, -0.8, -0.793333, -0.786667, -0.78, -0.773333, -0.766667, -0.76, -0.753333, -0.746667, -0.74, -0.733333, -0.726667, -0.72, -0.713333, -0.706667, -0.7, -0.693333, -0.686667, -0.68, -0.673333, -0.666667, -0.66, -0.653333, -0.646667, -0.64, -0.633333, -0.626667, -0.62, -0.613333, -0.606667, -0.6, -0.593333, -0.586667, -0.58, -0.573333, -0.566667, -0.56, -0.553333, -0.546667, -0.54, -0.533333, -0.526667, -0.52, -0.513333, -0.506667, -0.5, -0.493333, -0.486667, -0.48, -0.473333, -0.466667, -0.46, -0.453333, -0.446667, -0.44, -0.433333, -0.426667, -0.42, -0.413333, -0.406667, -0.4, -0.393333, -0.386667, -0.38, -0.373333, -0.366667, -0.36, -0.353333, -0.346667, -0.34, -0.333333, -0.326667, -0.32, -0.313333, -0.306667, -0.3, -0.293333, -0.286667, -0.28, -0.273333, -0.266667, -0.26, -0.253333, -0.246667, -0.24, -0.233333, -0.226667, -0.22, -0.213333, -0.206667, -0.2, -0.193333, -0.186667, -0.18, -0.173333, -0.166667, -0.16, -0.153333, -0.146667, -0.14, -0.133333, -0.126667, -0.12, -0.113333, -0.106667, -0.1, -0.0933333, -0.0866667, -0.08, -0.0733333, -0.0666667, -0.06, -0.0533333, -0.0466667, -0.04, -0.0333333, -0.0266667, -0.02, -0.0133333, -0.00666667, 0, 0.00666667, 0.0133333, 0.02, 0.0266667, 0.0333333, 0.04, 0.0466667, 0.0533333, 0.06, 0.0666667, 0.0733333, 0.08, 0.0866667, 0.0933333, 0.1, 0.106667, 0.113333, 0.12, 0.126667, 0.133333, 0.14, 0.146667, 0.153333, 0.16, 0.166667, 0.173333, 0.18, 0.186667, 0.193333, 0.2, 0.206667, 0.213333, 0.22, 0.226667, 0.233333, 0.24, 0.246667, 0.253333, 0.26, 0.266667, 0.273333, 0.28, 0.286667, 0.293333, 0.3, 0.306667, 0.313333, 0.32, 0.326667, 0.333333, 0.34, 0.346667, 0.353333, 0.36, 0.366667, 0.373333, 0.38, 0.386667, 0.393333, 0.4, 0.406667, 0.413333, 0.42, 0.426667, 0.433333, 0.44, 0.446667, 0.453333, 0.46, 0.466667, 0.473333, 0.48, 0.486667, 0.493333, 0.5, 0.506667, 0.513333, 0.52, 0.526667, 0.533333, 0.54, 0.546667, 0.553333, 0.56, 0.566667, 0.573333, 0.58, 0.586667, 0.593333, 0.6, 0.606667, 0.613333, 0.62, 0.626667, 0.633333, 0.64, 0.646667, 0.653333, 0.66, 0.666667, 0.673333, 0.68, 0.686667, 0.693333, 0.7, 0.706667, 0.713333, 0.72, 0.726667, 0.733333, 0.74, 0.746667, 0.753333, 0.76, 0.766667, 0.773333, 0.78, 0.786667, 0.793333, 0.8, 0.806667, 0.813333, 0.82, 0.826667, 0.833333, 0.84, 0.846667, 0.853333, 0.86, 0.866667, 0.873333, 0.88, 0.886667, 0.893333, 0.9, 0.906667, 0.913333, 0.92, 0.926667, 0.933333, 0.94, 0.946667, 0.953333, 0.96, 0.966667, 0.973333, 0.98, 0.986667, 0.993333};
  double outputTMVA[300] = {0, 2.69665e-05, 2.69665e-05, 5.39331e-05, 0.000107866, 0.000242699, 0.000242699, 0.000323598, 0.000431465, 0.000458431, 0.00070113, 0.000728096, 0.000835963, 0.000970795, 0.00110563, 0.00129439, 0.00148316, 0.00177979, 0.00194159, 0.00218429, 0.00253485, 0.00269665, 0.00293935, 0.00315508, 0.00345172, 0.00380228, 0.00434161, 0.00477308, 0.00509668, 0.00571691, 0.00614837, 0.00698433, 0.00779333, 0.00854839, 0.00900682, 0.00960009, 0.0105709, 0.0113799, 0.0123507, 0.0134563, 0.0141574, 0.0152091, 0.0157485, 0.0163957, 0.017744, 0.0189575, 0.0202519, 0.0211687, 0.0220317, 0.0234609, 0.0248092, 0.0258879, 0.0272362, 0.0284497, 0.0297711, 0.0313621, 0.0327643, 0.0348947, 0.0365936, 0.0379149, 0.0397217, 0.0412318, 0.0427959, 0.0444678, 0.0465442, 0.0485937, 0.0504814, 0.0526387, 0.0552814, 0.0575196, 0.0597578, 0.0623466, 0.0643691, 0.0664455, 0.0694928, 0.0722703, 0.0745085, 0.0775018, 0.0803333, 0.0829491, 0.0862659, 0.088612, 0.0921716, 0.0949492, 0.09832, 0.101799, 0.105439, 0.108217, 0.111803, 0.114743, 0.11814, 0.122051, 0.126176, 0.130383, 0.133619, 0.137637, 0.141386, 0.145457, 0.149098, 0.153709, 0.158267, 0.162932, 0.167058, 0.171318, 0.17628, 0.181566, 0.187148, 0.191705, 0.197179, 0.202411, 0.207966, 0.213548, 0.21886, 0.223984, 0.229458, 0.234852, 0.24011, 0.24607, 0.251328, 0.256398, 0.261683, 0.267238, 0.272793, 0.278807, 0.28447, 0.289675, 0.294879, 0.30092, 0.306394, 0.313081, 0.31745, 0.321819, 0.32705, 0.332605, 0.337055, 0.342178, 0.347383, 0.352722, 0.357981, 0.362781, 0.368579, 0.373325, 0.378152, 0.383356, 0.38821, 0.392929, 0.398188, 0.40377, 0.40795, 0.413451, 0.418602, 0.423482, 0.429388, 0.434566, 0.439905, 0.444624, 0.448669, 0.453227, 0.458242, 0.462045, 0.466332, 0.471213, 0.475069, 0.479816, 0.484454, 0.488795, 0.493164, 0.497586, 0.501847, 0.506485, 0.511582, 0.516598, 0.5204, 0.52485, 0.529677, 0.53445, 0.540113, 0.544886, 0.550036, 0.55454, 0.559636, 0.564571, 0.569857, 0.574819, 0.580347, 0.58547, 0.591079, 0.5965, 0.602945, 0.609228, 0.614432, 0.620716, 0.626244, 0.632851, 0.638136, 0.644204, 0.650217, 0.65704, 0.662514, 0.669255, 0.675835, 0.681768, 0.688833, 0.694901, 0.702182, 0.708303, 0.715611, 0.721813, 0.729337, 0.736429, 0.742847, 0.749265, 0.755737, 0.761805, 0.767683, 0.773346, 0.779549, 0.786209, 0.791549, 0.796699, 0.803414, 0.809023, 0.815468, 0.820834, 0.826848, 0.832484, 0.838713, 0.844727, 0.850902, 0.856943, 0.863738, 0.869671, 0.875765, 0.882965, 0.888682, 0.89448, 0.900682, 0.907262, 0.912871, 0.917833, 0.924035, 0.930022, 0.937411, 0.942373, 0.947496, 0.952593, 0.958876, 0.963433, 0.967047, 0.970741, 0.974598, 0.978292, 0.980611, 0.983308, 0.985303, 0.988081, 0.989995, 0.991856, 0.993285, 0.994903, 0.995739, 0.997115, 0.997708, 0.99849, 0.998948, 0.999245, 0.999569, 0.999784, 0.999919, 0.999919, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1};
  FlattenTMVA = new TabulatedFunction1D(inputTMVA, outputTMVA, 300, gsl_interp_linear);


  float NB;
  float TMVA;
  float MIX;

  TTree* outtree = new TTree("simpletree","simpletree");
  TH2F* corr = new TH2F("corr","corr",100,0.,1.0001,100,0.,1.0001);
  corr->GetXaxis()->SetTitle("TMVA");
  corr->GetYaxis()->SetTitle("NB");
  outtree->Branch("TMVA",&TMVA);
  outtree->Branch("NB",&NB);
  outtree->Branch("MIX",&MIX);
  outtree->Branch("truetau",&truetau);
  outtree->Branch("productionweightMC11v3",&productionweightMC11v3);
  Long64_t nentries = fChain->GetEntriesFast();

  Long64_t nbytes = 0, nb = 0;
  for (Long64_t jentry=0; jentry<nentries;jentry++) {
    Long64_t ientry = LoadTree(jentry);
    if (ientry < 0) break;
    nb = fChain->GetEntry(jentry);   nbytes += nb;
    // if (Cut(ientry) < 0) continue;
    if (!cleaningcut) continue;
    if (!(Hlt1Dec&&Hlt2Dec&&L0Dec)) continue;
    if (mass_p0p1<250.) continue;
    if (abs(mass_p0p2-1020.4)<20.) continue;
    if (abs(mass_p1p2-1020.4)<20.) continue;
    if (-40.>NeuroBayes_0x145cf818) continue;
    if (-1.>TMVA_0x145cf818 || 0.993333<TMVA_0x145cf818) {
      std::cout << "TMVA out of range" << std::endl;
    }
    if (-1.2>NeuroBayes_0x145cf818 || 1.2<NeuroBayes_0x145cf818) {
      std::cout << "NB out of range" << std::endl;
    }
    NB = FlattenNB->value(NeuroBayes_0x145cf818);
    TMVA = FlattenTMVA->value(TMVA_0x145cf818);
    MIX = FlattenMIX->value(std::min(NB,TMVA));


    // Double-check result
    if (MIX < 0) MIX = 0;
    if (MIX > 1) MIX = 1;
    if (NB < 0) NB = 0;
    if (NB > 1) NB = 1;
    if (TMVA < 0) TMVA = 0;
    if (TMVA > 1) TMVA = 1;
    corr->Fill(TMVA,NB,productionweightMC11v3);

    outtree->Fill();

  }
  TFile* ff = new TFile("output.root","recreate");
  ff->WriteTObject(outtree);
  ff->WriteTObject(corr);
  ff->Close();
  delete ff;
  delete FlattenTMVA;
  delete FlattenNB;
}
